{% extends "base.html" %}

{% block content %}

<div class="container mt-5">
    <h2 class="mb-6 pt-3">Kalkulator wartości skrzyń</h2>
    <form action="{{ url_for('main.calculate') }}" method="POST">
        <div id="fields-container" class="row">
            <!-- Etykieta dla 'Wybierz skrzynię' i 'Liczba skrzyń' tylko raz na początku -->
            {% for i in range(form_data['case_code']|length) %}
                <div class="row mb-3">
                    <!-- Skrzynia (select) -->
                    <div class="col-md-4">
                        <select name="case_code[]" class="form-select" required>
                            {% for chest_name, chest_info in cases.items() %}
                                <option value="{{ chest_info['code'] }}" {% if chest_info['code'] == form_data['case_code'][i] %} selected {% endif %}>
                                    {{ chest_name }} - {{ chest_info['latest_price'] }}
                                </option>
                            {% endfor %}
                        </select>
                    </div>

                    <!-- Liczba skrzyń (input) -->
                    <div class="col-md-2">
                        <input type="number" name="quantity[]" class="form-control" min="1" required value="{{ form_data['quantity'][i] }}">
                    </div>

                    <div class="col-md-1 col-md-1 d-flex justify-content-center align-items-center">
                        <button type="button" class="btn btn-danger mt-2" onclick="this.closest('.row').remove()">Usuń</button>
                    </div>
                </div>
            {% endfor %}

        </div>

        <button type="submit" class="btn btn-primary mt-4">Oblicz łączną wartość</button>
        <button type="button" class="btn btn-secondary mt-4" id="add_button">Dodaj</button>
    </form>

    {% if total_value is not none %}
        <h4 class="mt-3 col-md-3 pt-3">Łączna wartość: {{ total_value }} zł</h4>
    {% endif %}
</div>

<script>
    var casesData = {{ cases | tojson }};
</script>
<script src="{{ url_for('static', filename='js/calculate.js') }}"></script>

{% endblock %}

