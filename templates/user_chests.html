{% extends "base.html" %}

{% block content %}

<div class="container mt-3 py-5">
    <h2 class="mb-6">Dodaj skrzynie</h2>
    <form action="{{ url_for('main.user_chests') }}" method="POST">
        <div id="fields-container" class="row">
            {% if user_cases_data %}
                {% for i in range(user_cases_data|length) %}
                    {% include 'user_case_field.html' %}
                {% endfor %}
            {% else %}
                {% include 'user_case_field.html' %}
            {% endif %}
        </div>

        <button type="submit" class="btn btn-primary mt-4">Dodaj</button>
        <button type="button" class="btn btn-primary mt-4" id="one_more_chest">Jeszcze jedna</button>
    </form>
</div>

<h2>Twoje Skrzynie</h2>
<table class="table table-dark table-striped table-sm">
    <thead>
        <tr>
            <th>Nazwa skrzyni</th>
            <th>Ilość</th>
            <th>Wartość jednostkowa</th>
            <th>Łączna wartość</th>
            <th>Netto</th>
            <th>Zmiana (%)</th>
            <th>Akcje</th>
        </tr>
    </thead>
    <tbody id="priceTableBody">
        {% for case in user_cases %}
        <tr>
            <td>{{ case.name }}</td>
            <td>{{ case.quantity }}</td>
            <td>{{ case.unit_price }} zł</td>
            <td>{{ case.total_price }} zł</td>
            <td>{{ case.total_price_after_tax }} zł</td>
            <td>
                {% if case.change_percent  > 0 %}
                    <span style="color: lightgreen;">+{{ case.change_percent  }}%</span>
                {% elif case.change_percent  < 0 %}
                    <span style="color: red;">{{ case.change_percent  }}%</span>
                {% else %}
                    <span>{{ case.change_percent  }}%</span>
                {% endif %}
            </td>
            <td>
                <form action="{{ url_for('main.edit_chest', case_id=case.id) }}" method="POST" class="d-inline edit-form">
                    <input type="number" name="new_quantity" value="{{ case.quantity }}" min="1" required>
                    <button type="submit" class="btn btn-warning btn-sm">Edytuj</button>
                </form>
                <form action="{{ url_for('main.delete_chest', case_id=case.id) }}" method="POST" class="d-inline delete-form">
                    <button type="submit" class="btn btn-danger btn-sm">Usuń</button>
                </form>
            </td>
        </tr>
        {% endfor %}
    </tbody>
</table>

<h3>Łączna wartość inwestycji: {{ total_value }} zł</h3>
<h3>Łączna wartość inwestycji netto: {{ total_value_after_tax }} zł</h3>
<h5>Podatek steam od wystawienia 5%, następnie podatek od gry 10%</h5>

<script>
    var casesData = {{ cases | tojson }};
</script>
<script src="{{ url_for('static', filename='js/users_chests.js') }}"></script>

{% endblock %}